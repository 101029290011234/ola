#!/bin/sh

ltmain=/usr/share/libtool/ltmain.sh

if [ \( ! -f config/ltmain.sh \) -a \( -f $ltmain \) ]; then
	ln -s $ltmain config/ltmain.sh
fi

perl -e "use Template" 2> /dev/null
if [ $? != 0 ]; then
  echo "ERROR: Could not find Template.pm, you need this to autogenerate\
 parts of the code"
  exit 1
fi

perl -e "use XML::Simple" 2> /dev/null
if [ $? != 0 ]; then
  echo "ERROR: Could not find XML::Simple, you need this to autogenerate\
 parts of the code"
  exit 1
fi

echo "Generating source files..."
pushd ./ > /dev/null
cd tools
./generate.sh
popd > /dev/null

echo "Running autotools"
rm -f config.cache
set -x
aclocal -I config
autoconf
autoheader
automake -a
exit
